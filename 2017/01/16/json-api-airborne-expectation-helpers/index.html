<!DOCTYPE html>
<html>
<head>
<title>Ross-Hunter: JSON API Helpers for API Testing in Rails using Airborne</title>
<meta content='I am a huge fan of the Airborne gem for testing APIs. Airborne uses rest_client to make HTTP requests and provides the following properties for ...' name='description'>
<meta charset='utf-8'>
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<meta content='IE=edge' http-equiv='X-UA-Compatible'>
<meta content='True' name='HandheldFriendly'>
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
<link href="../../../../images/images/favicon.ico" rel="icon" type="image/ico" />
<link href="../../../../stylesheets/application-ec71be74.css" rel="stylesheet" />
<link href='//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400' rel='stylesheet' type='text/css'>
</head>
<body class='post-template nav-closed'>
<div class='nav'>
<h3 class='nav-title'>Menu</h3>
<a class='nav-close' href='#'>
<span class='hidden'>Close</span>
</a>
<ul>
<li class='nav-home' role='presentation'>
<a href='/'>Home</a>
</li>
<li class='nav-blog' role='presentation'>
<a href='/blog/'>Blog</a>
</li>
<li class='nav-portfolio' role='presentation'>
<a href='/portfolio/'>Portfolio</a>
</li>
<li class='nav-github' role='presentation'>
<a href='https://github.com/ross-hunter'>GitHub</a>
</li>
<li class='nav-twitter' role='presentation'>
<a href='https://twitter.com/ross_hunter'>Twitter</a>
</li>
<li class='nav-linkedin' role='presentation'>
<a href='https://www.linkedin.com/in/rossh'>LinkedIn</a>
</li>
<li class='nav-facebook' role='presentation'>
<a href='http://www.facebook.com/ross.hunter'>Facebook</a>
</li>
<li class='nav-email' role='presentation'>
<a href='#email-protection-ebff-uhagre@ebff-uhagre.pbz'>Email</a>
</li>
</ul>
<a class='subscribe-button icon-feed' href='/feed.xml'>Subscribe</a>
</div>
<span class='nav-cover'></span>

<div class='site-wrapper'>
<header class='main-header no-cover post-head'>
<nav class='main-nav clearfix'>
<a class='menu-button icon-menu' href='#'>
<span class='word'>Menu</span>
</a>
</nav>
</header>
<main class='content' role='main'>
<article class='post'>
<header class='post-header'>
<h1 class='post-title'>JSON API Helpers for API Testing in Rails using Airborne</h1>
<section class='post-meta'>
<time class='post-date' datetime='2017-01-16'>
16 January 2017
</time>
<a href='/tag/api/'>api</a>, <a href='/tag/rails/'>rails</a>
</section>
</header>
<section class='post-content'><p>I am a huge fan of the <a href="https://github.com/brooklynDev/airborne">Airborne</a> gem for testing APIs. Airborne uses <code>rest_client</code> to make HTTP requests and provides the following properties for use in your tests.</p>

<ul>
<li><code>response</code> - The HTTP response returned from the request</li>
<li><code>headers</code> - A symbolized hash of the response headers returned by the request</li>
<li><code>body</code> - The raw HTTP body returned from the request</li>
<li><code>json_body</code> - A symbolized hash representation of the JSON returned by the request</li>
</ul>

<p>It also provides some nice expectation helpers. A simple Airborne request spec looks like this&hellip;</p>
<pre class="highlight ruby"><code><span class="n">describe</span> <span class="s1">'sample spec'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'should validate types'</span> <span class="k">do</span>
    <span class="n">get</span> <span class="s1">'http://example.com/api/v1/simple_get'</span> <span class="c1">#json api that returns { "name" : "John Doe" }</span>
    <span class="n">expect_json_types</span><span class="p">(</span><span class="ss">name: :string</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'should validate values'</span> <span class="k">do</span>
    <span class="n">get</span> <span class="s1">'http://example.com/api/v1/simple_get'</span> <span class="c1">#json api that returns { "name" : "John Doe" }</span>
    <span class="n">expect_json</span><span class="p">(</span><span class="ss">name: </span><span class="s1">'John Doe'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>The built-in matchers are nice, but they left me wanting when I was working on an API conforming to the <a href="http://jsonapi.org/">JSON API</a> spec. I came up with he following matchers as a much easier way to test the API and ensure it conformed to the JSON API spec.</p>

<script src="https://gist.github.com/Ross-Hunter/5619d8f4e5bf21a59d51805eba7334f9.js"></script>

<p>Using these helpers a request spec might look something like this.</p>
<pre class="highlight ruby"><code><span class="n">describe</span> <span class="s1">'widgets'</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="n">create</span> <span class="ss">:user</span> <span class="p">}</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:widget_attributes</span><span class="p">)</span> <span class="p">{</span> <span class="p">{</span> <span class="ss">name: </span><span class="s1">'foo'</span> <span class="p">}</span> <span class="p">}</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:widget_relations</span><span class="p">)</span> <span class="p">{</span> <span class="p">{</span> <span class="s1">'organization'</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">data: </span><span class="p">{</span> <span class="ss">id:  </span><span class="n">organization</span><span class="p">.</span><span class="nf">id</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>

    <span class="n">before</span> <span class="ss">:example</span> <span class="k">do</span>
        <span class="n">authenticate</span> <span class="n">user</span>
    <span class="k">end</span>

    <span class="n">example</span> <span class="s1">'creating a widget'</span> <span class="k">do</span>
      <span class="n">authed_post</span> <span class="n">widgets_path</span><span class="p">,</span> <span class="ss">attributes: </span><span class="n">widget_attributes</span><span class="p">,</span>
                                <span class="ss">relationships: </span><span class="n">widget_relations</span>
      <span class="n">expect_status</span> <span class="ss">:ok</span>
      <span class="n">expect_attributes</span> <span class="ss">name: </span><span class="n">widget_attributes</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
      <span class="n">expect_relationship</span> <span class="ss">key: </span><span class="s1">'organization'</span><span class="p">,</span> 
                          <span class="ss">link: </span><span class="n">organization_path</span><span class="p">(</span><span class="n">organization</span><span class="p">.</span><span class="nf">id</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>You might notice that also uses an <code>authed_post</code> helper, which is from another set of helpers I created for making token-auth requests easier and JSON API compliant.</p>

<script src="https://gist.github.com/Ross-Hunter/85efd826f038fd81910e800834c3d323.js"></script>

<p>I&rsquo;m thinking about packaging up these helpers as a gem, but they might be best served as just public gists for you to fork and modify for your own needs.</p>
</section>
<footer class='post-footer'>
<figure class='author-image'>
<a class='img' href='/' style='background-image: url(https://www.gravatar.com/avatar/99057d911bd664e8cde1a2995ee25401?size=68)'>
<span class='hidden'>Ross Hunter's Picture</span>
</a>
</figure>
<section class='author'>
<h4>
<a href='/'>Ross Hunter</a>
</h4>
<p></p>
I do things with computers sometimes
<div class='author-meta'>
<span class='author-location icon-location'>Grand Rapids, MI</span>
</div>
</section>
<section class='share'>
<h4>Share this post</h4>
<a class='icon-twitter' href='https://twitter.com/share?text=JSON API Helpers for API Testing in Rails using Airborne&amp;amp;url=http://www.ross-hunter.com/2017/01/16/json-api-airborne-expectation-helpers/' onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
<span class='hidden'>Twitter</span>
</a>
<a class='icon-facebook' href='https://www.facebook.com/sharer/sharer.php?u=http://www.ross-hunter.com/2017/01/16/json-api-airborne-expectation-helpers/' onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
<span class='hidden'>Facebook</span>
</a>
<a class='icon-google-plus' href='https://plus.google.com/share?url=http://www.ross-hunter.com/2017/01/16/json-api-airborne-expectation-helpers/' onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
<span class='hidden'>Google+</span>
</a>
</section>
<section class='comments'>
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = 'http://ross-hunter.com/2017/01/16/json-api-airborne-expectation-helpers/';  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = 19; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//ross-hunter.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</section>
</footer>
</article>
</main>
<aside class='read-next'>
<a class='no-cover read-next-story' href='/2016/05/09/topic-based-retro/'>
<section class='post'>
<h2>Topic Based Retro</h2>
<p>At Modustri we have always had weekly retrospectives amongst the dev team. We tried a couple different formats, but&hellip;</p>
</section>
</a>
</aside>

<footer class='site-footer clearfix'>
<section class='copyright'>
<a href='/'>Ross-Hunter</a>
&copy;
2017
</section>
<section class='poweredby'>
Based on the Casper theme powered by
<a href='https://ghost.org' target='_blank'>Ghost</a>
</section>
</footer>
</div>
<script src="../../../../javascripts/application-2ee90952.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-4184025-5', 'auto');
  ga('send', 'pageview');
</script>
<script type="text/javascript">!function(){try{var a,b,c,d,g=document.getElementsByTagName("a");for(c=0;g.length-c;c++)try{b=g[c].getAttribute("href"),b&&b.indexOf("#email-protection-")>-1&&b.length>19&&(a="",d=19+b.indexOf("#email-protection-"),b.length>d&&(a=b.substr(18).replace(/[a-zA-Z]/g,function(a){return String.fromCharCode(("Z">=a?90:122)>=(a=a.charCodeAt(0)+13)?a:a-26)})),g[c].setAttribute("href","mailto:"+a))}catch(h){}}catch(h){}}();</script>
</body>
</html>
